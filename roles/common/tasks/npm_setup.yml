---
# Node.js and npm setup tasks

- name: Check if Node.js is already installed
  ansible.builtin.command: node --version
  register: common_node_existing
  changed_when: false
  failed_when: false

- name: Install Node.js if not present
  when: common_node_existing.rc != 0
  block:
    - name: Detect package manager
      ansible.builtin.include_tasks: detect_package_manager.yml

    - name: Set up NodeSource repository and install Node.js
      ansible.builtin.include_tasks: nodesource_setup.yml

    - name: Verify Node.js installation
      ansible.builtin.command: node --version
      changed_when: false

- name: Verify NPM is available
  ansible.builtin.command: npm --version
  changed_when: false

- name: Mark npm as installed
  ansible.builtin.set_fact:
    common_npm_installed: true
